# База данных ТН ВЭД

## Описание

Система поддерживает загрузку полной базы данных ТН ВЭД для улучшения точности классификации. База данных хранится в памяти и используется для быстрого поиска релевантных кодов при анализе документов.

## Формат данных

База данных должна быть в формате JSON и содержать массив объектов со следующей структурой:

```json
{
  "code": "8517 12 000 0",           // Обязательно: 10-значный код ТН ВЭД
  "name": "Полное наименование",     // Обязательно: Название товара
  "section": "XVI",                  // Раздел ТН ВЭД (I-XXI)
  "group": "85",                     // Группа (2 знака)
  "position": "8517",                // Позиция (4 знака)
  "subsection": "851712",           // Подпозиция (6 знаков)
  "subsubsection": "8517120000",     // Субпозиция (10 знаков)
  "keywords": ["ключевое", "слово"], // Массив ключевых слов для поиска
  "category": "Категория товара",    // Категория товара
  "dutyRate": 0,                     // Опционально: Ставка пошлины (%)
  "vatRate": 20,                     // Опционально: Ставка НДС (%)
  "notes": "Примечания"              // Опционально: Дополнительная информация
}
```

## Загрузка базы данных

### Через API

1. Отправьте POST запрос на `/api/tnved/load`
2. В теле запроса отправьте файл JSON с кодами ТН ВЭД

Пример с использованием curl:

```bash
curl -X POST http://localhost:3000/api/tnved/load \
  -F "file=@tnved-database.json"
```

### Формат файла

Файл должен содержать массив объектов:

```json
[
  {
    "code": "8517 12 000 0",
    "name": "Телефоны мобильные",
    ...
  },
  {
    "code": "6302 31 000 0",
    "name": "Постельное белье",
    ...
  }
]
```

## Получение статистики

Для получения статистики базы данных отправьте GET запрос:

```bash
curl http://localhost:3000/api/tnved/load
```

Ответ:
```json
{
  "totalCodes": 1000,
  "categories": 50,
  "sections": 21
}
```

## Использование в анализе

После загрузки базы данных, система автоматически:

1. Ищет релевантные коды ТН ВЭД при анализе документа
2. Добавляет найденные коды в промпт для ИИ
3. Использует коды как справочную информацию для более точной классификации

## Где взять базу данных ТН ВЭД?

### Официальные источники:

1. **Евразийская экономическая комиссия (ЕЭК)**
   - Сайт: https://www.eurasiancommission.org
   - Раздел: ТН ВЭД ЕАЭС

2. **ФТС России**
   - Сайт: https://customs.gov.ru
   - Раздел: Товарная номенклатура

3. **Коммерческие базы данных:**
   - КонсультантПлюс
   - Гарант
   - Специализированные таможенные сервисы

### Формат экспорта

Большинство баз данных можно экспортировать в JSON формат. Если у вас есть база в другом формате (Excel, CSV, XML), нужно конвертировать её в JSON согласно описанной структуре.

## Пример скрипта для конвертации

Если у вас есть база в CSV формате:

```javascript
const fs = require('fs');
const csv = require('csv-parser');

const codes = [];

fs.createReadStream('tnved.csv')
  .pipe(csv())
  .on('data', (row) => {
    codes.push({
      code: row.code.replace(/\s+/g, ' '),
      name: row.name,
      section: row.section,
      group: row.group,
      position: row.position,
      subsection: row.subsection,
      subsubsection: row.subsubsection,
      keywords: row.keywords ? row.keywords.split(',') : [],
      category: row.category || 'Не указана',
      dutyRate: parseFloat(row.dutyRate) || undefined,
      vatRate: parseFloat(row.vatRate) || undefined,
    });
  })
  .on('end', () => {
    fs.writeFileSync('tnved-database.json', JSON.stringify(codes, null, 2));
    console.log(`Конвертировано ${codes.length} кодов`);
  });
```

## Ограничения

- База данных хранится в памяти сервера (не сохраняется между перезапусками)
- Для продакшена рекомендуется использовать внешнюю базу данных (PostgreSQL, MongoDB)
- Максимальный размер файла: 50 МБ (можно изменить в настройках)

## Рекомендации

1. Загружайте актуальную версию базы данных ТН ВЭД
2. Регулярно обновляйте базу (ставки пошлин могут меняться)
3. Добавляйте ключевые слова для улучшения поиска
4. Используйте категории для группировки товаров
