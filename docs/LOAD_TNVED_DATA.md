# Инструкция по загрузке базы данных ТН ВЭД

## Быстрый старт

### Вариант 1: Автоматическая конвертация (рекомендуется)

1. **Скачайте Excel файл с кодами ТН ВЭД:**
   - Перейдите на https://tws.by/tws/tnved/download
   - Скачайте актуальный файл (обновляется ежедневно)

2. **Установите зависимости:**
   ```bash
   npm install
   ```

3. **Конвертируйте Excel в JSON:**
   ```bash
   node scripts/download-tnved.js путь/к/файлу.xlsx
   ```

4. **Загрузите базу данных:**
   - Откройте http://localhost:3000/admin/tnved
   - Загрузите созданный файл `public/tnved-database.json`

### Вариант 2: Ручная загрузка

1. Скачайте Excel файл с https://tws.by/tws/tnved/download
2. Конвертируйте в JSON вручную (используя онлайн-конвертер или Excel)
3. Убедитесь, что формат соответствует структуре (см. ниже)
4. Загрузите через `/admin/tnved`

## Формат данных

JSON файл должен содержать массив объектов:

```json
[
  {
    "code": "8517 12 000 0",
    "name": "Телефоны мобильные, включая смартфоны",
    "section": "XVI",
    "group": "85",
    "position": "8517",
    "subsection": "851712",
    "subsubsection": "8517120000",
    "keywords": ["телефон", "смартфон", "мобильный"],
    "category": "Электроника",
    "dutyRate": 0,
    "vatRate": 20
  }
]
```

## Источники данных

### Бесплатные источники:

1. **TWS.by** (рекомендуется)
   - URL: https://tws.by/tws/tnved/download
   - Формат: Excel
   - Обновление: Ежедневно
   - Бесплатно: ✅

2. **Евразийская экономическая комиссия**
   - URL: https://portal.eaeunion.org
   - Требует регистрации
   - Официальный источник

### Платные источники:

1. **TKS.ru API**
   - URL: https://www.tks.ru/tnvedapi/
   - Стоимость: от 3000 руб/месяц
   - Формат: JSON API
   - Полная информация по всем кодам

## Актуальные ставки пошлин на 2026 год

Система уже содержит актуальные ставки таможенных сборов на 2026 год:

- **Минимальная ставка сбора:** 1 231 руб (для товаров до 200 000 руб)
- **Максимальная ставка сбора:** 73 860 руб (для товаров от 10 млн руб)
- **Для радиоэлектроники:** фиксированная ставка 73 860 руб
- **НДС:** стандартная 22% (повышена с 20% с 01.01.2026, ФЗ №425-ФЗ), пониженная 10% (продукты питания, детские товары, лекарства)

Ставки автоматически используются при анализе документов.

## Решение проблем

### Скрипт не работает

Если скрипт конвертации не работает:

1. Проверьте формат Excel файла
2. Адаптируйте скрипт под структуру вашего файла
3. Используйте онлайн-конвертер: https://bfotool.com/ru/xlsx-to-json

### Неверные названия колонок

Скрипт ищет колонки с названиями:
- `Код ТН ВЭД`, `Code`, `код`
- `Наименование`, `Name`, `наименование`
- `Категория`, `Category`
- `Пошлина`, `Duty`
- `НДС`, `VAT`

Если в вашем файле другие названия - измените скрипт.

### Большой размер файла

Если файл очень большой (>50 МБ):
- Разбейте на части
- Загружайте по частям
- Или используйте внешнюю базу данных (PostgreSQL, MongoDB)

## Обновление базы данных

Рекомендуется обновлять базу данных:
- **Еженедельно** - для актуальности ставок
- **При изменении законодательства** - обязательно
- **При появлении новых кодов** - по необходимости

## Интеграция с внешней БД

Для продакшена рекомендуется использовать внешнюю базу данных:

1. PostgreSQL с таблицей `tnved_codes`
2. MongoDB с коллекцией `tnved`
3. Redis для кэширования популярных кодов

Пример структуры для PostgreSQL:

```sql
CREATE TABLE tnved_codes (
  code VARCHAR(13) PRIMARY KEY,
  name TEXT NOT NULL,
  section VARCHAR(10),
  group_code VARCHAR(2),
  position VARCHAR(4),
  keywords TEXT[],
  category VARCHAR(100),
  duty_rate DECIMAL(5,2),
  vat_rate DECIMAL(5,2),
  updated_at TIMESTAMP DEFAULT NOW()
);

CREATE INDEX idx_tnved_keywords ON tnved_codes USING GIN(keywords);
CREATE INDEX idx_tnved_category ON tnved_codes(category);
```

## Поддержка

Если возникли проблемы:
1. Проверьте документацию в `docs/TNVED_DATABASE.md`
2. Посмотрите пример файла в `public/tnved-example.json`
3. Проверьте логи сервера
